# NeuroNova 수동 배포 가이드 (Non-Docker)

이 가이드는 Docker를 사용하지 않고, Ubuntu 서버 환경에서 NeuroNova 프로젝트를 수동으로 배포하는 방법을 설명합니다.

## 목차
1. [배포 전 정리 (Cleanup)](#1-배포-전-정리-cleanup)
2. [서버 환경 준비](#2-서버-환경-준비)
3. [프로젝트 클론 및 설정](#3-프로젝트-클론-및-설정)
4. [Backend (Django) 배포](#4-backend-django-배포)
5. [Frontend (React) 배포](#5-frontend-react-배포)
6. [Web Server (Nginx) 설정](#6-web-server-nginx-설정)
7. [서비스 관리 (Systemd)](#7-서비스-관리-systemd)

---

## 1. 배포 전 정리 (Cleanup)

배포하기 전에 개발용 더미 파일과 불필요한 파일들을 정리해야 합니다.

### 1.1 더미 파일 삭제
다음 파일들은 개발 및 테스트 목적으로 사용되었으므로 실제 운영 환경 배포 시에는 삭제하거나 실제 데이터로 대체해야 합니다.

- `frontend/react_web/public/proteins.json`: 항원 검사 모의 데이터용 파일.
  - **조치**: 실제 백엔드 API가 준비되었다면 이 파일을 삭제하고, `AntigenResultPage.jsx`에서 API를 호출하도록 수정해야 합니다. (현재는 기능 시연을 위해 유지할 수 있음)
- `users_list_utf8.txt`, `list_users.py`: 사용자 관리 유틸리티 파일 (이미 삭제됨).
- `protein-viewer/`: 프로토타입 디렉토리 (이미 삭제됨).

### 1.2 코드 확인
- `frontend/react_web/src/utils/config.js`: API 엔드포인트가 운영 서버 주소를 가리키는지 확인합니다.
- `backend/django_main/config/settings/production.py`: `DEBUG = False` 및 `ALLOWED_HOSTS` 설정 확인.

---

## 2. 서버 환경 준비

**OS**: Ubuntu 22.04 LTS (권장)

### 2.1 필수 패키지 설치
```bash
sudo apt-get update
sudo apt-get upgrade -y
sudo apt-get install -y git curl wget build-essential libmysqlclient-dev pkg-config python3-pip python3-venv python3-dev nginx redis-server
```

### 2.2 Node.js 설치 (v18)
```bash
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install -y nodejs
```

### 2.3 데이터베이스 (MySQL) 준비
MySQL 서버가 별도로 존재하거나 로컬에 설치되어 있어야 합니다.
```bash
# 로컬 설치 시
sudo apt-get install -y mysql-server
sudo mysql_secure_installation
```

---

## 3. 프로젝트 클론 및 설정

```bash
cd ~
git clone https://github.com/your-username/NeuroNova.git
cd NeuroNova
```

---

## 4. Backend (Django) 배포

### 4.1 가상환경 생성 및 패키지 설치
```bash
cd backend/django_main
python3 -m venv venv
source venv/bin/activate
pip install -r requirements.txt
pip install gunicorn  # 운영용 WSGI 서버
```

### 4.2 환경변수 설정
`.env` 파일을 생성하고 운영 환경 설정을 입력합니다.
```bash
cp .env.example .env
nano .env
```
**주요 설정:**
- `DEBUG=False`
- `ALLOWED_HOSTS=your-domain.com`
- `DB_HOST`, `DB_USER`, `DB_PASSWORD` 등 데이터베이스 정보

### 4.3 정적 파일 수집 및 마이그레이션
```bash
python manage.py collectstatic --noinput
python manage.py migrate
```

---

## 5. Frontend (React) 배포

### 5.1 패키지 설치 및 빌드
```bash
cd ../../frontend/react_web
npm install --legacy-peer-deps
npm run build
```
빌드가 완료되면 `dist` 폴더가 생성됩니다. 이 폴더를 Nginx가 서빙하게 됩니다.

---

## 6. Web Server (Nginx) 설정

Nginx를 리버스 프록시로 설정하여 React 정적 파일과 Django API를 연결합니다.

### 6.1 Nginx 설정 파일 생성
```bash
sudo nano /etc/nginx/sites-available/neuronova
```

**설정 내용 예시:**
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # Frontend (React)
    location / {
        root /home/ubuntu/NeuroNova/frontend/react_web/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # Backend (Django API)
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # Static Files (Django Admin 등)
    location /static/ {
        alias /home/ubuntu/NeuroNova/backend/django_main/staticfiles/;
    }
    
    # Media Files
    location /media/ {
        alias /home/ubuntu/NeuroNova/backend/django_main/media/;
    }
}
```

### 6.2 설정 활성화 및 재시작
```bash
sudo ln -s /etc/nginx/sites-available/neuronova /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl restart nginx
```

---

## 7. 서비스 관리 (Systemd)

Django 서버를 백그라운드에서 실행하고 관리하기 위해 Systemd 서비스를 등록합니다.

### 7.1 Gunicorn 서비스 파일 생성
```bash
sudo nano /etc/systemd/system/gunicorn.service
```

**내용:**
```ini
[Unit]
Description=gunicorn daemon
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/NeuroNova/backend/django_main
ExecStart=/home/ubuntu/NeuroNova/backend/django_main/venv/bin/gunicorn --access-logfile - --workers 3 --bind unix:/run/gunicorn.sock neuronova.wsgi:application

[Install]
WantedBy=multi-user.target
```
*참고: 위 Nginx 설정에서 `proxy_pass http://unix:/run/gunicorn.sock;`으로 변경하면 소켓 통신이 가능합니다. 포트 방식(8000)을 유지하려면 `ExecStart`를 `--bind 127.0.0.1:8000`으로 변경하세요.*

### 7.2 서비스 시작 및 등록
```bash
sudo systemctl start gunicorn
sudo systemctl enable gunicorn
```

이제 서버가 재부팅되어도 자동으로 실행됩니다.
