# NeuroNova ì„œë²„ ë°°í¬ ê°€ì´ë“œ

ë³¸ ë¬¸ì„œëŠ” Dockerë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , Ubuntu ì„œë²„ í™˜ê²½ì—ì„œ NeuroNova í”„ë¡œì íŠ¸(Django + Flask + React)ë¥¼ ë°°í¬í•˜ê¸° ìœ„í•œ ê°€ì´ë“œì…ë‹ˆë‹¤.

---

## ğŸ“‹ ë°°í¬ ì „ ì²´í¬ë¦¬ìŠ¤íŠ¸

âš ï¸ **GitHubì—ì„œ ëˆ„ë½ë˜ëŠ” í•„ìˆ˜ íŒŒì¼ë“¤** (`.gitignore`ë¡œ ì¸í•´ Gitì— í¬í•¨ë˜ì§€ ì•ŠìŒ):

- [ ] **ML ëª¨ë¸ íŒŒì¼** - `backend/flask_inference/final_model/` (ìš©ëŸ‰ ë° ë³´ì•ˆ ë¬¸ì œ)

âœ… **ë°°í¬ ì‹œ ë°˜ë“œì‹œ ìˆ˜í–‰í•´ì•¼ í•  ì‘ì—…**:

1. Git ì €ì¥ì†Œ í´ë¡ 
2. ML ëª¨ë¸ íŒŒì¼ì„ ë³„ë„ë¡œ ì„œë²„ì— ì—…ë¡œë“œ (ì„¹ì…˜ 3-1 ì°¸ì¡°)
3. `.env` íŒŒì¼ì˜ í™˜ê²½ ë³€ìˆ˜ ê°’ì„ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì • (ì„¹ì…˜ 3-2 ì°¸ì¡°)
4. `DEBUG=False` ì„¤ì • ë° ë³´ì•ˆ ì„¤ì • í™•ì¸

> **ğŸ’¡ Tip**: `.env` íŒŒì¼ì€ ì´ì œ Gitì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©° ê°œë°œìš© ê¸°ë³¸ê°’ì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ë°°í¬ ì‹œ ë°˜ë“œì‹œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ ê°’ìœ¼ë¡œ ìˆ˜ì •í•˜ì„¸ìš”.

---

## 1. ì „ì²´ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

ë³´ì•ˆì„ ìœ„í•´ Flask ML ì„œë²„ëŠ” ë¡œì»¬ ì „ìš©ìœ¼ë¡œ ë™ì‘í•˜ë©°, Djangoë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼ ê°€ëŠ¥í•©ë‹ˆë‹¤. NginxëŠ” React ì •ì  íŒŒì¼ì„ ì„œë¹™í•˜ê³  Djangoë§Œ í”„ë¡ì‹œí•©ë‹ˆë‹¤.

```
[Flutter App]      [React Web]
      â†“                 â†“
              [Nginx:80]
                 â”‚
                 â”œâ”€â”€ / : React ì •ì  íŒŒì¼ ì„œë¹™
                 â”‚
                 â””â”€â”€ /api/, /admin/, /ml/ : Django í”„ë¡ì‹œ
                                               â†“
                                    [Django:8000 (Gunicorn)]
                                               â”‚
                                               â”œâ”€â”€ Django ì•± ì²˜ë¦¬
                                               â”‚
                                               â””â”€â”€ /ml/* â†’ Flask í”„ë¡ì‹œ
                                                            â†“
                                               [Flask:127.0.0.1:9000 (Gunicorn)]
                                                     (ë¡œì»¬ ì „ìš©, ì™¸ë¶€ ì ‘ê·¼ ë¶ˆê°€)
                 â†“
          [MySQL + Redis]
```

### ë¼ìš°íŒ… ê·œì¹™
- **`/`**: React ë¹Œë“œ ê²°ê³¼ë¬¼ (Frontend) - Nginxê°€ ì§ì ‘ ì„œë¹™
- **`/api/`**: Django Main Server (Backend) - Nginx â†’ Django
- **`/admin/`**: Django Admin - Nginx â†’ Django
- **`/ml/`**: ML API - Nginx â†’ Django â†’ Flask (ë¡œì»¬)
- **`/static/`**: Django ì •ì  íŒŒì¼ (Admin, DRF UI ë“±) - Nginxê°€ ì§ì ‘ ì„œë¹™
- **`/media/`**: Django ë¯¸ë””ì–´ íŒŒì¼ (ì—…ë¡œë“œëœ ì´ë¯¸ì§€ ë“±) - Nginxê°€ ì§ì ‘ ì„œë¹™

### ë³´ì•ˆ íŠ¹ì§•
âœ… FlaskëŠ” `127.0.0.1:9000`ì—ì„œë§Œ ë™ì‘ (ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨)
âœ… Djangoê°€ Flaskë¡œ í”„ë¡ì‹œí•˜ì—¬ ë³´ì•ˆ ê³„ì¸µ ì¶”ê°€
âœ… NginxëŠ” Djangoë§Œ í”„ë¡ì‹œ (Flask ì§ì ‘ ë…¸ì¶œ ì•ˆ ë¨)

---

## 2. ì„œë²„ í´ë” êµ¬ì¡°

ì„œë²„ì˜ `/home/acorn/NeuroNova` ê²½ë¡œì— í”„ë¡œì íŠ¸ê°€ ìœ„ì¹˜í•œë‹¤ê³  ê°€ì •í•©ë‹ˆë‹¤.

```
/home/acorn/NeuroNova/           # Git ì €ì¥ì†Œ í´ë¡  ìœ„ì¹˜
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ django_main/             # Django ë©”ì¸ ì„œë²„
â”‚   â”‚   â”œâ”€â”€ manage.py
â”‚   â”‚   â”œâ”€â”€ venv/                # Djangoìš© ê°€ìƒí™˜ê²½
â”‚   â”‚   â”œâ”€â”€ staticfiles/         # collectstatic ê²°ê³¼ë¬¼
â”‚   â”‚   â””â”€â”€ ...
â”‚   â””â”€â”€ flask_inference/         # Flask AI ì„œë²„
â”‚       â”œâ”€â”€ app.py
â”‚       â”œâ”€â”€ venv/                # Flaskìš© ê°€ìƒí™˜ê²½
â”‚       â””â”€â”€ ...
â”œâ”€â”€ frontend/
â”‚   â””â”€â”€ react_web/
â”‚       â”œâ”€â”€ dist/                # React ë¹Œë“œ ê²°ê³¼ë¬¼ (Nginx root)
â”‚       â””â”€â”€ ...
â””â”€â”€ deploy/                      # ë°°í¬ ì„¤ì • íŒŒì¼ ëª¨ìŒ (ìƒì„±ë¨)
    â”œâ”€â”€ nginx/
    â”‚   â””â”€â”€ neuronova.conf
    â””â”€â”€ systemd/
        â”œâ”€â”€ gunicorn_django.service
        â””â”€â”€ gunicorn_flask.service

/var/www/                        # Nginx ì„œë¹™ ë””ë ‰í† ë¦¬ (ë¯¸ë¦¬ ìƒì„±)
â”œâ”€â”€ react/
â”œâ”€â”€ django_project/
â”œâ”€â”€ flask_ai/
â””â”€â”€ django_static/
```

> **ì£¼ì˜**: ìœ„ ê²½ë¡œì—ì„œ `acorn`ì€ ì„œë²„ì˜ ì‚¬ìš©ì ê³„ì • ì´ë¦„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì¸ ê²½ìš° ëª¨ë“  ì„¤ì • íŒŒì¼ì—ì„œ ê²½ë¡œë¥¼ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.

---

## 3. Nginx ì„¤ì • íŒŒì¼

`/etc/nginx/sites-available/neuronova` ê²½ë¡œì— ìƒì„±í•©ë‹ˆë‹¤.

```nginx
server {
    listen 80;
    server_name YOUR_DOMAIN_OR_IP;

    client_max_body_size 100M;  # DICOM íŒŒì¼ ì—…ë¡œë“œìš©

    # 1. React Frontend (Static Files)
    location / {
        root /home/ubuntu/NeuroNova/frontend/react_web/dist;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # 2. Django Backend API
    location /api/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # Timeout ì„¤ì •
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # 3. Django Admin
    location /admin/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # 4. ML API (Djangoë¥¼ í†µí•´ Flaskë¡œ í”„ë¡ì‹œë¨)
    # FlaskëŠ” 127.0.0.1:9000ì—ì„œ ë¡œì»¬ ì „ìš©ìœ¼ë¡œ ë™ì‘
    # Djangoê°€ Flaskë¡œ ìš”ì²­ì„ ì „ë‹¬
    location /ml/ {
        proxy_pass http://127.0.0.1:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # AI ì¶”ë¡ ì€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŒ
        proxy_connect_timeout 300s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }

    # 5. Django Static Files
    location /static/ {
        alias /home/ubuntu/NeuroNova/backend/django_main/staticfiles/;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # 6. Django Media Files
    location /media/ {
        alias /home/ubuntu/NeuroNova/backend/django_main/media/;
        expires 30d;
        add_header Cache-Control "public";
    }
}
```

> **ì£¼ì˜**: ìœ„ ì„¤ì •ì—ì„œ `/home/ubuntu`ëŠ” ì„œë²„ì˜ ì‚¬ìš©ì ê³„ì • ì´ë¦„ì…ë‹ˆë‹¤.
> ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì„ ì‚¬ìš©í•˜ëŠ” ê²½ìš° (ì˜ˆ: `acorn`), ê²½ë¡œë¥¼ `/home/acorn/NeuroNova`ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
>
> **ì¤‘ìš”**: Flask ML ì„œë²„ëŠ” Nginxì—ì„œ ì§ì ‘ í”„ë¡ì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. `/ml/` ê²½ë¡œë¡œ ë“¤ì–´ì˜¨ ìš”ì²­ì€ Djangoë¡œ ì „ë‹¬ë˜ê³ , Djangoê°€ ë‚´ë¶€ì ìœ¼ë¡œ Flask(`127.0.0.1:9000`)ë¡œ í”„ë¡ì‹œí•©ë‹ˆë‹¤.

---

## 4. Django Gunicorn ì„œë¹„ìŠ¤ íŒŒì¼

`/etc/systemd/system/gunicorn_django.service` ê²½ë¡œì— ìƒì„±í•©ë‹ˆë‹¤.

```ini
[Unit]
Description=Gunicorn daemon for Django
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/NeuroNova/backend/django_main
Environment="PATH=/home/ubuntu/NeuroNova/backend/django_main/venv/bin"
ExecStart=/home/ubuntu/NeuroNova/backend/django_main/venv/bin/gunicorn \
          --access-logfile - \
          --error-logfile - \
          --workers 3 \
          --bind 127.0.0.1:8000 \
          --timeout 120 \
          neuronova.wsgi:application

Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

> **ì£¼ì˜**:
> - `User=ubuntu`ëŠ” ì„œë²„ì˜ ì‚¬ìš©ì ê³„ì • ì´ë¦„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì¸ ê²½ìš° ë³€ê²½í•˜ì„¸ìš”.
> - DjangoëŠ” `127.0.0.1:8000`ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤.

---

## 5. Flask Gunicorn ì„œë¹„ìŠ¤ íŒŒì¼

`/etc/systemd/system/gunicorn_flask.service` ê²½ë¡œì— ìƒì„±í•©ë‹ˆë‹¤.

```ini
[Unit]
Description=Gunicorn daemon for Flask AI (ë¡œì»¬ ì „ìš©)
After=network.target

[Service]
User=ubuntu
Group=www-data
WorkingDirectory=/home/ubuntu/NeuroNova/backend/flask_inference
Environment="PATH=/home/ubuntu/NeuroNova/backend/flask_inference/venv/bin"
ExecStart=/home/ubuntu/NeuroNova/backend/flask_inference/venv/bin/gunicorn \
          --access-logfile - \
          --error-logfile - \
          --workers 2 \
          --bind 127.0.0.1:9000 \
          --timeout 300 \
          app:app

Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

> **ì£¼ì˜**:
> - `User=ubuntu`ëŠ” ì„œë²„ì˜ ì‚¬ìš©ì ê³„ì • ì´ë¦„ì…ë‹ˆë‹¤. ë‹¤ë¥¸ ì‚¬ìš©ì ì´ë¦„ì¸ ê²½ìš° ë³€ê²½í•˜ì„¸ìš”.
> - FlaskëŠ” `127.0.0.1:9000`ì—ì„œ **ë¡œì»¬ ì „ìš©**ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤ (ì™¸ë¶€ ì ‘ê·¼ ë¶ˆê°€).
> - Djangoì˜ `ml_proxy` ì•±ì´ Flaskë¡œ ìš”ì²­ì„ í”„ë¡ì‹œí•©ë‹ˆë‹¤.
> - `--timeout 300`: AI ì¶”ë¡ ì€ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìœ¼ë¯€ë¡œ íƒ€ì„ì•„ì›ƒì„ 5ë¶„ìœ¼ë¡œ ì„¤ì •.

---

## 6. Django collectstatic êµ¬ì¡° ì„¤ëª…

DjangoëŠ” ê°œë°œ ëª¨ë“œ(`DEBUG=True`)ì—ì„œëŠ” ì •ì  íŒŒì¼ì„ ì§ì ‘ ì„œë¹™í•˜ì§€ë§Œ, ë°°í¬ ëª¨ë“œ(`DEBUG=False`)ì—ì„œëŠ” Nginxê°€ ì„œë¹™í•´ì•¼ í•©ë‹ˆë‹¤. ì´ë¥¼ ìœ„í•´ í©ì–´ì ¸ ìˆëŠ” ì •ì  íŒŒì¼ë“¤ì„ í•œ ê³³(`staticfiles`)ìœ¼ë¡œ ëª¨ìœ¼ëŠ” ì‘ì—…ì´ í•„ìš”í•©ë‹ˆë‹¤.

1. `settings.py` ì„¤ì • í™•ì¸:
   ```python
   STATIC_URL = '/static/'
   STATIC_ROOT = os.path.join(BASE_DIR, 'staticfiles')
   ```
2. ëª…ë ¹ì–´ ì‹¤í–‰:
   ```bash
   python manage.py collectstatic
   ```
3. ê²°ê³¼: `backend/django_main/staticfiles/` í´ë”ì— ëª¨ë“  ì •ì  íŒŒì¼ì´ ë³µì‚¬ë©ë‹ˆë‹¤.
4. Nginx ì—°ê²°: Nginx ì„¤ì •ì˜ `alias /home/acorn/NeuroNova/backend/django_main/staticfiles/;` ë¶€ë¶„ì´ ì´ í´ë”ë¥¼ ê°€ë¦¬í‚µë‹ˆë‹¤.

---

## 7. ë°°í¬ ëª…ë ¹ì–´ ëª©ë¡ (ìš”ì•½)

ì„œë²„ ì ‘ì† í›„ ìˆœì„œëŒ€ë¡œ ì‹¤í–‰í•˜ì„¸ìš”.

### 1) ì„œë²„ ì ‘ì† (PuTTY ì‚¬ìš©)
1. PuTTYë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. Host Nameì— ì„œë²„ IP ì£¼ì†Œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤.
3. PortëŠ” 22 (SSH ê¸°ë³¸ í¬íŠ¸)ë¡œ ì„¤ì •í•©ë‹ˆë‹¤.
4. Connection typeì€ SSHë¡œ ì„ íƒí•©ë‹ˆë‹¤.
5. Open ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ì ‘ì†í•©ë‹ˆë‹¤.
6. ì‚¬ìš©ì ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸(ë˜ëŠ” SSH í‚¤)ë¡œ ë¡œê·¸ì¸í•©ë‹ˆë‹¤.

### 2) í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ìµœì´ˆ 1íšŒ)
```bash
# ì‹œìŠ¤í…œ íŒ¨í‚¤ì§€ ì—…ë°ì´íŠ¸
sudo apt-get update

# Nginx ì„¤ì¹˜
# sudo apt-get install nginx -y

# Python ë° í•„ìˆ˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
sudo apt-get install python3-dev python3-venv python3-pip -y
sudo apt-get install libmariadb-dev build-essential -y

# Node.js ë° npm ì„¤ì¹˜ (React ë¹Œë“œìš©)
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt-get install nodejs -y
```

> **ì£¼ì˜**: ì´ ë‹¨ê³„ëŠ” ìµœì´ˆ ì„œë²„ ì„¸íŒ… ì‹œ **1íšŒë§Œ** ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.

### 3) Git ì €ì¥ì†Œ í´ë¡  (ìµœì´ˆ 1íšŒ)
ì²˜ìŒ ë°°í¬í•˜ëŠ” ê²½ìš°, í”„ë¡œì íŠ¸ë¥¼ ì„œë²„ì— í´ë¡ í•©ë‹ˆë‹¤.

```bash
# í™ˆ ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd ~

# Git ì €ì¥ì†Œ í´ë¡ 
git clone https://github.com/kimhanbyul1208/NeuroNova.git

# í´ë¡  í™•ì¸
ls -la NeuroNova
```

> **ì£¼ì˜**:
> - ì´ ë‹¨ê³„ëŠ” ìµœì´ˆ ë°°í¬ ì‹œ **1íšŒë§Œ** ì‹¤í–‰í•©ë‹ˆë‹¤.
> - ì´í›„ ë°°í¬ì—ì„œëŠ” `git pull`ë§Œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤.
> - Private ì €ì¥ì†Œì¸ ê²½ìš°, GitHub Personal Access Tokenì´ë‚˜ SSH í‚¤ ì„¤ì •ì´ í•„ìš”í•©ë‹ˆë‹¤.

### 3-1) ML ëª¨ë¸ íŒŒì¼ ì—…ë¡œë“œ (í•„ìˆ˜)

âš ï¸ **ì¤‘ìš”**: ML ëª¨ë¸ íŒŒì¼(`final_model`)ì€ ìš©ëŸ‰ì´ í¬ê³  ë¯¼ê°í•œ ì •ë³´ê°€ í¬í•¨ë˜ì–´ ìˆì–´ Gitì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

#### ë°©ë²• 1: SCPë¥¼ ì‚¬ìš©í•œ ì—…ë¡œë“œ (ê¶Œì¥)

ë¡œì»¬ ì»´í“¨í„°ì—ì„œ ì‹¤í–‰:

```bash
# Windows (PowerShell ë˜ëŠ” CMD)
scp -r "backend\flask_inference\final_model" ubuntu@your-server-ip:~/NeuroNova/backend/flask_inference/

# Linux/Mac
scp -r backend/flask_inference/final_model ubuntu@your-server-ip:~/NeuroNova/backend/flask_inference/
```

#### ë°©ë²• 2: WinSCP ë˜ëŠ” FileZilla ì‚¬ìš©

1. WinSCP ë˜ëŠ” FileZillaë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
2. ì„œë²„ì— SFTPë¡œ ì ‘ì†í•©ë‹ˆë‹¤.
3. ë¡œì»¬ì˜ `backend/flask_inference/final_model` í´ë”ë¥¼ ì„œë²„ì˜ `~/NeuroNova/backend/flask_inference/` ê²½ë¡œë¡œ ë“œë˜ê·¸ ì•¤ ë“œë¡­í•©ë‹ˆë‹¤.

#### ë°©ë²• 3: í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©

```bash
# ì„œë²„ì—ì„œ ì‹¤í–‰
cd ~/NeuroNova/backend/flask_inference

# Google Drive, AWS S3, ë˜ëŠ” ë‹¤ë¥¸ í´ë¼ìš°ë“œ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë‹¤ìš´ë¡œë“œ
# ì˜ˆì‹œ (wget ì‚¬ìš©):
# wget https://your-storage-url/final_model.tar.gz
# tar -xzf final_model.tar.gz
# rm final_model.tar.gz
```

#### ëª¨ë¸ íŒŒì¼ í™•ì¸

```bash
# ëª¨ë¸ ë””ë ‰í† ë¦¬ í™•ì¸
cd ~/NeuroNova/backend/flask_inference
ls -la final_model/

# íŒŒì¼ ê¶Œí•œ ì„¤ì •
chmod -R 755 final_model/
```

> **ì£¼ì˜ì‚¬í•­**:
> - `final_model` ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ Flask ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
> - ëª¨ë¸ íŒŒì¼ì€ ë³´ì•ˆì´ ì¤‘ìš”í•˜ë¯€ë¡œ ì•ˆì „í•œ ë°©ë²•ìœ¼ë¡œ ì „ì†¡í•˜ì„¸ìš”.
> - íŒŒì¼ í¬ê¸°ê°€ í¬ë¯€ë¡œ ë„¤íŠ¸ì›Œí¬ ìƒíƒœì— ë”°ë¼ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 3-2) í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìˆ˜ì • (í•„ìˆ˜)

âœ… `.env` íŒŒì¼ì€ Git ì €ì¥ì†Œì— í¬í•¨ë˜ì–´ ìˆìœ¼ë©° ê°œë°œìš© ê¸°ë³¸ê°’ì´ ì„¤ì •ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

âš ï¸ **ì¤‘ìš”**: ë°°í¬ ì‹œ ë°˜ë“œì‹œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ ê°’ìœ¼ë¡œ ìˆ˜ì •í•´ì•¼ í•©ë‹ˆë‹¤.

#### Django í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì •

```bash
cd ~/NeuroNova/backend/django_main

# .env íŒŒì¼ ìˆ˜ì •
nano .env
```

ë‹¤ìŒ í•­ëª©ë“¤ì„ **ë°˜ë“œì‹œ** ì‹¤ì œ ê°’ìœ¼ë¡œ ë³€ê²½í•˜ì„¸ìš”:

```bash
# Django Settings
SECRET_KEY=your-actual-secret-key-here  # âš ï¸ ë³€ê²½ í•„ìˆ˜!
DEBUG=False  # âš ï¸ ë°°í¬ í™˜ê²½ì—ì„œëŠ” ë°˜ë“œì‹œ False
ALLOWED_HOSTS=your-domain.com,your-server-ip  # âš ï¸ ì‹¤ì œ ë„ë©”ì¸/IPë¡œ ë³€ê²½

# Database Configuration
DB_NAME=your-actual-database-name  # âš ï¸ ì‹¤ì œ DB ì´ë¦„
DB_USER=your-actual-database-user  # âš ï¸ ì‹¤ì œ DB ì‚¬ìš©ì
DB_PASSWORD=your-actual-database-password  # âš ï¸ ì‹¤ì œ DB ë¹„ë°€ë²ˆí˜¸
DB_HOST=your-actual-db-host  # âš ï¸ ì‹¤ì œ DB í˜¸ìŠ¤íŠ¸

# Flask AI Inference Server
FLASK_INFERENCE_URL=http://127.0.0.1:9000  # ë¡œì»¬ ì „ìš©
FLASK_API_KEY=your-flask-api-key-here  # âš ï¸ ê°•ë ¥í•œ API í‚¤ë¡œ ë³€ê²½

# JWT Settings
JWT_SECRET_KEY=your-actual-jwt-secret-key  # âš ï¸ ë³€ê²½ í•„ìˆ˜!
```

#### Flask í™˜ê²½ ë³€ìˆ˜ ìˆ˜ì •

```bash
cd ~/NeuroNova/backend/flask_inference

# .env íŒŒì¼ ìˆ˜ì •
nano .env
```

ë‹¤ìŒ í•­ëª©ì„ Djangoì™€ ì¼ì¹˜í•˜ë„ë¡ ìˆ˜ì •í•˜ì„¸ìš”:

```bash
# API í‚¤ (Djangoì˜ FLASK_API_KEYì™€ ë™ì¼í•´ì•¼ í•¨)
API_KEY=your-flask-api-key-here  # âš ï¸ Django .envì˜ FLASK_API_KEYì™€ ë™ì¼í•˜ê²Œ ì„¤ì •
```

> **ë³´ì•ˆ ì£¼ì˜ì‚¬í•­**:
> - `SECRET_KEY`, `JWT_SECRET_KEY`: ìµœì†Œ 50ì ì´ìƒì˜ ë¬´ì‘ìœ„ ë¬¸ìì—´ ì‚¬ìš©
> - `DEBUG`: ë°°í¬ í™˜ê²½ì—ì„œëŠ” **ë°˜ë“œì‹œ False**
> - `ALLOWED_HOSTS`: ì‹¤ì œ ë„ë©”ì¸ê³¼ IPë§Œ í¬í•¨
> - `FLASK_API_KEY`: Djangoì™€ Flaskì—ì„œ ë™ì¼í•œ ê°•ë ¥í•œ í‚¤ ì‚¬ìš©
> - Gitì— ë¯¼ê°í•œ ì •ë³´ë¥¼ ì»¤ë°‹í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜ (`.env.production` ì‚¬ìš© ê¶Œì¥)

### 4) ì½”ë“œ ì—…ë°ì´íŠ¸ ë° í´ë” ì¤€ë¹„
```bash
cd ~/NeuroNova
git pull origin main
mkdir -p backend/django_main/staticfiles
mkdir -p backend/django_main/media
```

### 5) Backend (Django) ì„¤ì •
```bash
cd backend/django_main
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install python-dotenv
pip install -r requirements.txt
pip install gunicorn mysqlclient faker
python manage.py migrate
# [ì„ íƒì‚¬í•­] í…ŒìŠ¤íŠ¸ ë°ì´í„° ìƒì„± (ì£¼ì˜: ê°œë°œ/ìŠ¤í…Œì´ì§• í™˜ê²½ì—ì„œë§Œ ì‚¬ìš©)
# python manage.py init_test_data --count 100
python manage.py collectstatic --noinput
deactivate
cd ../..
```

> **ì£¼ì˜**:
> - `python-dotenv`ëŠ” Django settingsì—ì„œ í™˜ê²½ ë³€ìˆ˜ íŒŒì¼(.env)ì„ ì½ê¸° ìœ„í•´ í•„ìš”í•©ë‹ˆë‹¤.
> - `mysqlclient` ì„¤ì¹˜ê°€ ì‹¤íŒ¨í•˜ëŠ” ê²½ìš°, ìœ„ì˜ **2) í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜** ë‹¨ê³„ë¥¼ ë¨¼ì € ìˆ˜í–‰í–ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.
> - `init_test_data` ëª…ë ¹ì–´ëŠ” í…ŒìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤. `--clear` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ê¸°ì¡´ ë°ì´í„°ê°€ ëª¨ë‘ ì‚­ì œë˜ë¯€ë¡œ ì£¼ì˜í•˜ì„¸ìš”.

### 6) AI Server (Flask) ì„¤ì •
```bash
cd backend/flask_inference
python3 -m venv venv
source venv/bin/activate
pip install --upgrade pip
pip install python-dotenv
pip install -r requirements.txt
pip install gunicorn
deactivate
cd ../..
```

### 7) Frontend (React) ë¹Œë“œ
```bash
cd frontend/react_web
npm install
npm run build
cd ../..
```

### 8) ì„¤ì • íŒŒì¼ ì ìš© ë° ì„œë¹„ìŠ¤ ì¬ì‹œì‘
```bash
# Nginx ì„¤ì • ë³µì‚¬ (ìµœì´ˆ 1íšŒ)
sudo cp deploy/nginx/neuronova.conf /etc/nginx/sites-available/
sudo ln -s /etc/nginx/sites-available/neuronova.conf /etc/nginx/sites-enabled/
sudo rm /etc/nginx/sites-enabled/default

# Systemd ì„œë¹„ìŠ¤ ë³µì‚¬ (ìµœì´ˆ 1íšŒ)
sudo cp deploy/systemd/*.service /etc/systemd/system/

# ë°ëª¬ ë¦¬ë¡œë“œ ë° ì¬ì‹œì‘
sudo systemctl daemon-reload
sudo systemctl restart gunicorn_django
sudo systemctl restart gunicorn_flask
sudo systemctl restart nginx
```

---

## 8. ì•„í‚¤í…ì²˜ ìƒì„¸ ì„¤ëª…

### Django ml_proxy ì•±ì˜ ì—­í• 

Djangoì˜ `ml_proxy` ì•±ì€ Flask ML ì„œë²„ë¡œ ìš”ì²­ì„ í”„ë¡ì‹œí•˜ëŠ” ì¤‘ê°„ ê³„ì¸µì…ë‹ˆë‹¤.

**ìš”ì²­ íë¦„:**
```
í´ë¼ì´ì–¸íŠ¸ â†’ Nginx:80 â†’ Django:8000 â†’ Flask:127.0.0.1:9000
   |              |            |                |
   |              |            |                â””â”€ ML ì¶”ë¡  ìˆ˜í–‰
   |              |            â””â”€ ml_proxy ì•±ì´ Flaskë¡œ í”„ë¡ì‹œ
   |              â””â”€ /ml/ ê²½ë¡œë¥¼ Djangoë¡œ í”„ë¡ì‹œ
   â””â”€ POST /ml/v1/predict
```

**ì—”ë“œí¬ì¸íŠ¸:**
- `POST /ml/v1/predict/`: AI ì¶”ë¡  ìš”ì²­ (Djangoê°€ Flaskë¡œ í”„ë¡ì‹œ)
- `GET /ml/v1/status/`: Flask ì„œë²„ ìƒíƒœ ì¡°íšŒ
- `GET /ml/v1/model-info/`: ëª¨ë¸ ì •ë³´ ì¡°íšŒ
- `POST /ml/v1/retrain/`: ëª¨ë¸ ì¬í•™ìŠµ ìš”ì²­
- `GET /ml/v1/history/`: ì¶”ë¡  ì´ë ¥ ì¡°íšŒ (Django DB ì €ì¥)

**ë³´ì•ˆ ì´ì :**
1. FlaskëŠ” ë¡œì»¬ ì „ìš©(`127.0.0.1:9000`)ìœ¼ë¡œ ë™ì‘í•˜ì—¬ ì™¸ë¶€ì—ì„œ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
2. Djangoì—ì„œ ì¸ì¦/ì¸ê°€ ë¡œì§ ì¶”ê°€ ê°€ëŠ¥
3. Djangoì—ì„œ ì¶”ë¡  ìš”ì²­/ì‘ë‹µì„ ë¡œê¹…í•˜ì—¬ ê°ì‚¬ ì¶”ì  ê°€ëŠ¥
4. Rate limiting, API í‚¤ ê²€ì¦ ë“± ì¶”ê°€ ë³´ì•ˆ ê³„ì¸µ êµ¬í˜„ ê°€ëŠ¥

### Flask í¬íŠ¸ ë³€ê²½ ì‚¬í•­

- **ê¸°ì¡´**: Flaskê°€ í¬íŠ¸ 5000ì—ì„œ ë™ì‘
- **ë³€ê²½**: Flaskê°€ í¬íŠ¸ 9000ì—ì„œ ë™ì‘
- **ì´ìœ **: í¬íŠ¸ 5000ì€ macOSì—ì„œ AirPlayì™€ ì¶©ëŒí•  ìˆ˜ ìˆìœ¼ë©°, 9000ë²ˆ í¬íŠ¸ê°€ ë” ëª…í™•í•œ êµ¬ë¶„

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

**Django `.env` íŒŒì¼ (`backend/django_main/.env`):**
```bash
# Flask ML ì„œë²„ (ë¡œì»¬ ì „ìš©)
FLASK_INFERENCE_URL=http://127.0.0.1:9000
```

**Flask `.env` íŒŒì¼ (`backend/flask_inference/.env`):**
```bash
# í¬íŠ¸ ì„¤ì •
PORT=9000

# ëª¨ë¸ ë””ë ‰í† ë¦¬
MODEL_DIR=./final_model
```

---

## 9. ì„œë²„ ë³´ì•ˆ/ìš´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ (í•„ìˆ˜)

- [ ] **DEBUG ëª¨ë“œ ë„ê¸°**: Django `settings.py`ì—ì„œ `DEBUG = False` ì„¤ì •.
- [ ] **ALLOWED_HOSTS ì„¤ì •**: Django `settings.py`ì— ì‹¤ì œ ë„ë©”ì¸ ë˜ëŠ” IP ì¶”ê°€.
- [ ] **ë¹„ë°€í‚¤ ë¶„ë¦¬**: `SECRET_KEY`, DB ë¹„ë°€ë²ˆí˜¸ ë“±ì€ `.env` íŒŒì¼ë¡œ ê´€ë¦¬í•˜ê³  gitì— ì˜¬ë¦¬ì§€ ì•ŠìŒ.
- [ ] **Flask ë¡œì»¬ ì „ìš© í™•ì¸**: Flaskê°€ `127.0.0.1:9000`ì—ì„œë§Œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸ (ì™¸ë¶€ ì ‘ê·¼ ë¶ˆê°€)
- [ ] **ë°©í™”ë²½ ì„¤ì • (UFW)**:
  ```bash
  sudo ufw allow 'Nginx Full'
  sudo ufw allow ssh
  sudo ufw enable

  # Flask í¬íŠ¸ëŠ” ì™¸ë¶€ì—ì„œ ì ‘ê·¼ ë¶ˆê°€í•˜ë„ë¡ ì°¨ë‹¨ (ì´ë¯¸ 127.0.0.1ë¡œ ë°”ì¸ë”©ë˜ì–´ ìˆìŒ)
  # Django í¬íŠ¸ë„ ì™¸ë¶€ ì ‘ê·¼ ì°¨ë‹¨ (Nginxë¥¼ í†µí•´ì„œë§Œ ì ‘ê·¼)
  ```
- [ ] **HTTPS ì ìš© (Certbot)**:
  ```bash
  sudo apt install certbot python3-certbot-nginx
  sudo certbot --nginx -d yourdomain.com
  ```
- [ ] **ë¡œê·¸ í™•ì¸**: ë¬¸ì œ ë°œìƒ ì‹œ ë¡œê·¸ í™•ì¸
  - Nginx: `/var/log/nginx/error.log`
  - Django: `sudo journalctl -u gunicorn_django -f`
  - Flask: `sudo journalctl -u gunicorn_flask -f`

### ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸ ë° ì¬ì‹œì‘

```bash
# ì„œë¹„ìŠ¤ ìƒíƒœ í™•ì¸
sudo systemctl status gunicorn_django
sudo systemctl status gunicorn_flask
sudo systemctl status nginx

# ì„œë¹„ìŠ¤ ì¬ì‹œì‘
sudo systemctl restart gunicorn_django
sudo systemctl restart gunicorn_flask
sudo systemctl restart nginx

# ì„œë¹„ìŠ¤ ë¡œê·¸ ì‹¤ì‹œê°„ í™•ì¸
sudo journalctl -u gunicorn_django -f
sudo journalctl -u gunicorn_flask -f
```

### íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

**Flask ì—°ê²° ì˜¤ë¥˜ (502 Bad Gateway):**
1. Flask ì„œë¹„ìŠ¤ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸: `sudo systemctl status gunicorn_flask`
2. Flaskê°€ 127.0.0.1:9000ì—ì„œ ë¦¬ìŠ¤ë‹ ì¤‘ì¸ì§€ í™•ì¸: `sudo netstat -tulpn | grep 9000`
3. Django settingsì—ì„œ `FLASK_INFERENCE_URL`ì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
4. Flask ë¡œê·¸ í™•ì¸: `sudo journalctl -u gunicorn_flask -n 50`

**Django ml_proxy ì˜¤ë¥˜:**
1. Django ë¡œê·¸ í™•ì¸: `sudo journalctl -u gunicorn_django -n 50`
2. Djangoì—ì„œ Flaskë¡œ ì—°ê²° í…ŒìŠ¤íŠ¸:
   ```bash
   # Django ì„œë²„ì—ì„œ ì‹¤í–‰
   curl http://127.0.0.1:9000/health
   ```

**í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ì˜¤ë¥˜:**
1. .env íŒŒì¼ í™•ì¸ (Gitì— í¬í•¨ë˜ì–´ ìˆì–´ì•¼ í•¨):
   ```bash
   ls -la ~/NeuroNova/backend/django_main/.env
   ls -la ~/NeuroNova/backend/flask_inference/.env
   ```
2. í™˜ê²½ ë³€ìˆ˜ ê°’ì´ ê¸°ë³¸ê°’ì¸ì§€ í™•ì¸:
   ```bash
   # Django .envì—ì„œ ë³€ê²½ í•„ìš”í•œ í•­ëª© í™•ì¸
   grep -E "SECRET_KEY|DEBUG|DB_PASSWORD|FLASK_API_KEY" ~/NeuroNova/backend/django_main/.env

   # Flask API í‚¤ê°€ Djangoì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸
   grep "API_KEY" ~/NeuroNova/backend/flask_inference/.env
   ```
3. ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •ëœ ê²½ìš° "3-2) í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ ìˆ˜ì •" ì„¹ì…˜ ì°¸ì¡°

**ML ëª¨ë¸(final_model) ëˆ„ë½ ì˜¤ë¥˜:**
1. ëª¨ë¸ ë””ë ‰í† ë¦¬ í™•ì¸:
   ```bash
   ls -la ~/NeuroNova/backend/flask_inference/final_model/
   # ë””ë ‰í† ë¦¬ê°€ ì—†ìœ¼ë©´ "3-1) ML ëª¨ë¸ íŒŒì¼ ì—…ë¡œë“œ" ì„¹ì…˜ ì°¸ì¡°
   ```
2. Flask ì„œë¹„ìŠ¤ê°€ ëª¨ë¸ì„ ì°¾ì§€ ëª»í•˜ëŠ” ê²½ìš°:
   ```bash
   # Flask ë¡œê·¸ì—ì„œ ëª¨ë¸ ë¡œë”© ì˜¤ë¥˜ í™•ì¸
   sudo journalctl -u gunicorn_flask -n 100 | grep -i model

   # .env íŒŒì¼ì˜ MODEL_DIR ê²½ë¡œ í™•ì¸
   cat ~/NeuroNova/backend/flask_inference/.env | grep MODEL_DIR
   ```

**Gitì—ì„œ ëˆ„ë½ëœ íŒŒì¼ë“¤:**

GitHubì—ì„œ í´ë¡  ì‹œ ë‹¤ìŒ íŒŒì¼ì€ í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤ (`.gitignore`ì— ëª…ì‹œë¨):

- âŒ `backend/flask_inference/final_model/` (ML ëª¨ë¸ - ìš©ëŸ‰ ë° ë³´ì•ˆ ë¬¸ì œ)
- â„¹ï¸ `media/` (ì—…ë¡œë“œëœ íŒŒì¼ - ë°°í¬ ê³¼ì •ì—ì„œ ìë™ ìƒì„±)
- â„¹ï¸ `staticfiles/` (ë¹Œë“œ ê²°ê³¼ë¬¼ - collectstaticìœ¼ë¡œ ìë™ ìƒì„±)

âœ… `.env` íŒŒì¼ì€ ì´ì œ Gitì— í¬í•¨ë¨ (ê°œë°œìš© ê¸°ë³¸ê°’ í¬í•¨)

**í•´ê²° ë°©ë²•:**
1. **ì„¹ì…˜ 3-1**: `final_model` ë””ë ‰í† ë¦¬ë¥¼ ì„œë²„ì— ì—…ë¡œë“œ
2. **ì„¹ì…˜ 3-2**: `.env` íŒŒì¼ì˜ ê°’ì„ ì‹¤ì œ ìš´ì˜ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •
3. `media/`ì™€ `staticfiles/`ëŠ” ë°°í¬ ê³¼ì •ì—ì„œ ìë™ìœ¼ë¡œ ìƒì„±ë¨
